# Mock Indexer

This Mock Indexer is an app built using the app-sdk that is designed to post dummy blocks, transactions, and logs, featuring transactions from target address `0x1e3aA9fE4Ef01D3cB3189c129a49E3C03126C636` - [this lens](https://github.com/shinzonetwork/wasm-bucket/tree/main/bucket/filter_transaction) filters for transactions from that address. The mock indexer is meant to be used in conjunction with `demoWebApp` which queries and displays the results from two views, one with this lens and an identical view without it. Please be aware that the mock will first try to determine the current block number and then post blocks that are a few block numbers higher, so, given that the Host currently is designed to keep track of the most recent block number processed for each view and only queries and transforms new data, using the mock can make it such that the host will stop processing data from any real indexers you may be running for some time. The mock will also continue to post new data every 60 seconds or so. This mock indexer, and the remainder of this readme were generated by AI.

A utility tool that posts dummy blockchain data (blocks, transactions, and logs) to DefraDB for testing purposes.

## Purpose

This mock indexer generates fake blockchain data to help test the Shinzo network without needing to wait for real blockchain transactions. It's especially useful for demonstrating the lens filtering functionality.

## Features

- âœ… Posts 5-10 random blocks per batch
- âœ… Generates 2-8 transactions per block  
- âœ… Creates 3-12 logs per block
- âœ… **ALL logs use the target address** `0x1e3aA9fE4Ef01D3cB3189c129a49E3C03126C636`
- âœ… Uses realistic Ethereum hash formats (proper 64-char hex)
- âœ… Random but valid-looking data
- âœ… Connects to P2P network via bootstrap peer
- âœ… **Runs continuously** - posts a batch every minute until stopped

## Generated Data

### Blocks
- **Block numbers start at current Ethereum block height**
- Falls back to 2,000,000 if unable to fetch current block
- Random gas usage, timestamps, and other fields
- Sometimes mined by the target address

### Transactions
- 30% involve the target address (as sender)
- 20% involve the target address (as receiver)
- 50% use random addresses
- Realistic gas and value fields

### Logs
- **100% use the target address** `0x1e3aA9fE4Ef01D3cB3189c129a49E3C03126C636`
- Common event signatures (Transfer, Approval, Swap)
- 1-4 topics per log

## Usage

### Prerequisites

Make sure **bigPeer** is running on port 9176.

### Run

```bash
cd /Users/quinnpurdy/Documents/repos/mockIndexer
go run cmd/main.go
```

### Expected Output

```
ğŸ­ Starting Mock Indexer...
ğŸ“ This will post dummy blockchain data to DefraDB
â³ Starting DefraDB instance...
âœ“ DefraDB started successfully!
ğŸ” Fetching current Ethereum block number...
âœ“ Current Ethereum block: 21234567
ğŸ”„ Running continuously... Press Ctrl+C to stop
ğŸ¯ All logs will use target address: 0x1e3aA9fE4Ef01D3cB3189c129a49E3C03126C636

ğŸ“¦ Posting 7 blocks with dummy data...
  âœ“ Block 21234567: 5 txs, 8 logs (all with target address)
  âœ“ Block 21234568: 3 txs, 6 logs (all with target address)
  âœ“ Block 21234569: 7 txs, 11 logs (all with target address)
  ...
âœ… Batch complete! Posted 7 blocks
ğŸ’¤ Sleeping for 1 minute before posting more...

ğŸ“¦ Posting 6 blocks with dummy data...
  âœ“ Block 21234574: 4 txs, 9 logs (all with target address)
  ...
```

## Data Format

All generated data follows the same schema as the real indexer:

- Uses the same GraphQL schema from `indexer/schema/schema.graphql`
- Posts to the same collections: `Block`, `Transaction`, `Log`
- Makes data available via P2P to connected nodes

## Use Cases

### 1. Testing the Demo Apps

After running the mock indexer, your demo apps will immediately have data to display:

```bash
# Run mock indexer
cd mockIndexer
go run cmd/main.go

# Data is now available to host and demo apps!
```

### 2. Testing Lens Filtering

All logs use the target address, so the lens will show all of them:

- **Unfiltered view**: Shows all logs
- **Filtered view**: Shows all logs (100% match the target address)

### 3. Quick Demos

No need to wait for real transactions on the target address. Generate test data instantly!

## How It Works

1. **Starts DefraDB** with P2P enabled
2. **Connects to bigPeer** at `192.168.4.22:9176`
3. **Runs continuously**:
   - Posts 5-10 blocks per batch
   - Generates transactions with random from/to addresses
   - Creates logs ALL with the target address
   - Sleeps for 1 minute
   - Repeats until stopped with Ctrl+C
4. **Posts to collections** using DefraDB client API
5. **Never exits** - runs until you stop it

## Data Persistence

The mock data is stored in `./.defra` directory and synced via P2P to other nodes (host, demoApp, etc.) that are connected to the same bootstrap peer.

## Cleanup

To start fresh, delete the data directory:

```bash
rm -rf /Users/quinnpurdy/Documents/repos/mockIndexer/.defra
```

## Hash Format

All generated hashes use proper Ethereum format (64 hex characters after `0x` prefix). They look like real hashes but are randomly generated.

Examples:
- `0x3a1b5c2d4e6f7890abcdef1234567890abcdef1234567890abcdef1234567890`
- `0x78ab291c4def567890abc123456789012345678901234567890123456789abcd`

## Technical Details

- **Language**: Go
- **Database**: DefraDB (CRDT-based)
- **P2P**: libp2p
- **Schema**: Ethereum-compatible primitives
- **Randomization**: Math/rand with time-based seed

## Limitations

- Runs continuously until stopped (Ctrl+C)
- Doesn't validate blockchain rules (it's mock data!)
- Block numbers increment but don't form a real chain
- Hashes are randomly generated (not from real blockchain)
- All logs use the same target address (for testing purposes)

## Tips

- Let it run for a few minutes to generate a good amount of data
- Adjust the sleep duration (currently 1 minute) in the code if needed
- Adjust the numbers in code to generate more/less blocks per batch
- Stop it with Ctrl+C when you have enough test data

## Integration

The mock indexer integrates seamlessly with:
- âœ… **host** - Will process the primitives through lenses
- âœ… **demoApp** - Will display the filtered results
- âœ… **demoWebApp** - Will show the data in the web UI

No configuration changes needed - it just works!

---

Happy testing! ğŸ­

